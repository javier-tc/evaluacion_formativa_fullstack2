<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle del Producto - VinylStore</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="nav-brand">
                <h1><a href="index.html" class="nav-brand-link">VinylStore</a></h1>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Inicio</a></li>
                <li><a href="productos.html" class="nav-link nav-btn">Productos</a></li>
                <li><a href="blogs.html" class="nav-link">Blogs</a></li>
                <li><a href="login.html" class="nav-link">Ingresar</a></li>
                <li><a href="registro.html" class="nav-link nav-btn">Registrarse</a></li>
                <li>
                    <div class="cart-icon" onclick="cart.toggleCart()">
                        üõí
                        <span class="cart-count" id="cart-count"></span>
                    </div>
                </li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="detalle-producto-seccion">
            <div class="detalle-container">
                <div class="detalle-producto" id="detalle-producto">
                    <!--el contenido se cargar√° din√°micamente con javascript-->
                </div>
            </div>
        </section>

        <section class="productos-relacionados">
            <div class="productos-container">
                <h2>Productos Relacionados</h2>
                <div class="productos-grid" id="productos-relacionados-grid">
                    <!--los productos relacionados se cargar√°n din√°micamente-->
                </div>
            </div>
        </section>

    </main>

    <!--modal del carrito-->
    <div id="cart-modal" class="cart-modal">
        <div class="cart-content">
            <div class="cart-header">
                <h2>Mi Carrito</h2>
                <button class="close-cart" onclick="cart.closeCart()">&times;</button>
            </div>
            <div class="cart-body">
                <div id="cart-empty" class="cart-empty">
                    <p>Tu carrito est√° vac√≠o</p>
                    <p>¬°Agrega algunos vinilos!</p>
                </div>
                <div id="cart-items"></div>
            </div>
            <div class="cart-footer">
                <div class="cart-total">
                    Total: <span id="cart-total">$0</span>
                </div>
                <button class="checkout-btn" onclick="alert('¬°Gracias por tu compra!')" disabled>
                    Proceder al Pago
                </button>
            </div>
        </div>
    </div>

    <footer class="footer">
  <div class="footer-inner">
    <div class="footer-col">
      <h4 class="footer-title">Sobre VynilStore</h4>
      <ul class="footer-links">
        <li><a href="nosotros.html">Nosotros</a></li>
        <li><a href="contacto.html">Contacto</a></li>
      </ul>
    </div>
    <p class="footer-copy">&copy; 2024 VinylStore. Todos los derechos reservados.</p>
  </div>
</footer>


    <script src="productos.js"></script>
    <script src="cart.js"></script>
    <script>
        //cargar el detalle del producto usando el sistema din√°mico
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const productoId = parseInt(urlParams.get('id'));
            
            //obtener producto del sessionStorage o del productManager
            let producto = null;
            const productoGuardado = sessionStorage.getItem('productoDetalle');
            
            if (productoGuardado) {
                producto = JSON.parse(productoGuardado);
                sessionStorage.removeItem('productoDetalle'); //limpiar despu√©s de usar
            } else if (typeof productManager !== 'undefined') {
                producto = productManager.getProductoById(productoId);
            }
            
            if (!producto) {
                document.getElementById('detalle-producto').innerHTML = '<h2>Producto no encontrado</h2>';
                return;
            }
            
            //generar HTML del detalle del producto
            const detalleHTML = `
                <div class="detalle-imagen">
                    <img src="${producto.imagen}" alt="${producto.nombre}" loading="lazy">
                </div>
                <div class="detalle-info">
                    <div class="detalle-header">
                        <h1>${producto.nombre}</h1>
                        <p class="artista-detalle">${producto.artista}</p>
                        <p class="genero-detalle">${producto.genero} ‚Ä¢ ${producto.a√±o}</p>
                    </div>
                    
                    <div class="detalle-precio">
                        <span class="precio-detalle">$${producto.precio.toLocaleString()}</span>
                        <span class="stock-info ${producto.stock <= producto.stockCritico ? 'stock-critico' : ''}">
                            Stock: ${producto.stock} unidades
                            ${producto.stock <= producto.stockCritico ? ' - ¬°√öltimas unidades!' : ''}
                        </span>
                    </div>

                    <div class="detalle-descripcion">
                        <h3>Descripci√≥n</h3>
                        <p>${producto.descripcion}</p>
                    </div>

                    <div class="detalle-especificaciones">
                        <h3>Especificaciones</h3>
                        <ul>
                            <li><strong>Categor√≠a:</strong> ${producto.categoria}</li>
                            <li><strong>Stock Cr√≠tico:</strong> ${producto.stockCritico} unidades</li>
                            <li><strong>Estado:</strong> ${producto.stock > 0 ? 'Disponible' : 'Sin Stock'}</li>
                        </ul>
                    </div>

                    <div class="detalle-acciones">
                        <div class="cantidad-selector">
                            <label for="cantidad">Cantidad:</label>
                            <select id="cantidad">
                                ${Array.from({length: Math.min(10, producto.stock)}, (_, i) => `<option value="${i + 1}">${i + 1}</option>`).join('')}
                            </select>
                        </div>
                        <button class="comprar-btn" onclick="agregarAlCarrito(${producto.id})" ${producto.stock === 0 ? 'disabled' : ''}>
                            ${producto.stock === 0 ? 'Sin Stock' : 'Agregar al Carrito'}
                        </button>
                        <button class="comprar-ahora-btn" onclick="comprarAhora(${producto.id})" ${producto.stock === 0 ? 'disabled' : ''}>
                            ${producto.stock === 0 ? 'Sin Stock' : 'Comprar Ahora'}
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('detalle-producto').innerHTML = detalleHTML;
            
            //cargar productos relacionados
            cargarProductosRelacionados(productoId);
        });
        
        //cargar productos relacionados
        function cargarProductosRelacionados(productoIdExcluir) {
            if (typeof productManager === 'undefined') return;
            
            const productosRelacionados = productManager.getAllProductos().filter(producto => producto.id !== productoIdExcluir);
            const productosGrid = document.getElementById('productos-relacionados-grid');
            
            if (!productosGrid || productosRelacionados.length === 0) return;
            
            productosGrid.innerHTML = '';
            
            //mostrar m√°ximo 3 productos relacionados
            productosRelacionados.slice(0, 3).forEach(producto => {
                const productoCard = productManager.createProductCard(producto);
                productosGrid.appendChild(productoCard);
            });
        }
        
        //funciones para las acciones del carrito
        function agregarAlCarrito(productoId) {
            if (typeof productManager !== 'undefined') {
                productManager.agregarAlCarrito(productoId);
            } else {
                alert('Error: Sistema de productos no disponible');
            }
        }

        function comprarAhora(productoId) {
            if (typeof productManager !== 'undefined') {
                const producto = productManager.getProductoById(productoId);
                const cantidad = document.getElementById('cantidad').value;
                
                //agregar al carrito y proceder al checkout
                productManager.agregarAlCarrito(productoId);
                
                //simular redirecci√≥n al checkout
                setTimeout(() => {
                    alert(`Redirigiendo al checkout para comprar ${cantidad} ${cantidad > 1 ? 'copias' : 'copia'} de "${producto.nombre}"`);
                }, 500);
            } else {
                alert('Error: Sistema de productos no disponible');
            }
        }
    </script>
</body>
</html>
